---
deployment:
  tasks:
    - export DEPLOYPATH=/home/dratifshahzad/public_html
    - /bin/cp -R backend $DEPLOYPATH/
    - /bin/cp frontend/dist/index.html $DEPLOYPATH/
    - /bin/cp -R frontend/dist/assets $DEPLOYPATH/
    - cd $DEPLOYPATH/backend && python3.9 -m pip install --user -r requirements.txt
    - mkdir -p $DEPLOYPATH/myapp
    - /bin/cp -R $DEPLOYPATH/backend $DEPLOYPATH/myapp/
    - echo 'import sys, os; sys.path.insert(0, os.path.dirname(__file__)); sys.path.insert(0, os.path.join(os.path.dirname(__file__), "backend")); os.environ.setdefault("SECRET_KEY", "prod-secret"); os.environ.setdefault("JWT_SECRET_KEY", "jwt-secret"); os.environ.setdefault("DATABASE_URL", "sqlite:///app.db"); from app import create_app; application = create_app()' > $DEPLOYPATH/myapp/passenger_wsgi.py
    - echo 'RewriteEngine On' > $DEPLOYPATH/.htaccess
    - echo 'RewriteCond %{REQUEST_URI} ^/api/.*' >> $DEPLOYPATH/.htaccess
    - echo 'RewriteRule ^api/(.*)$ /myapp/api/$1 [L,QSA]' >> $DEPLOYPATH/.htaccess
    - echo 'RewriteCond %{REQUEST_FILENAME} !-f' >> $DEPLOYPATH/.htaccess
    - echo 'RewriteCond %{REQUEST_FILENAME} !-d' >> $DEPLOYPATH/.htaccess
    - echo 'RewriteCond %{REQUEST_URI} !^/api/.*' >> $DEPLOYPATH/.htaccess
    - echo 'RewriteRule . /index.html [L]' >> $DEPLOYPATH/.htaccess